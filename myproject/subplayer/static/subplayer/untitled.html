<!DOCTYPE html>
<html>
<head>
<style>
  body {
    font-family: 'Arial', sans-serif;
    background: linear-gradient(to right, #Bdd4e0, #eef8ff);
    color: #413F3F;
    line-height: 1.5;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  #audiofile {
    display: block;
    width: 80%;
    margin: 30px auto;
    box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
  }

  #subtitles {
    width: 80%;
    margin: 30px auto;
    font-size: 30px;
    padding: 20px;
    border-radius: 10px;
    background: #333;
    color: #fff;
    box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
  }

  #subtitles span {
    padding: 2px 5px;
    color: #Bdd4e0;
  }

  #subtitles span.highlight {
    color: #fff;
    font-weight: bold;
    background-color: #1a8cff;
    padding: 2px 4px;
    border-radius: 5px;
  }

  #podcast-cover {
    text-align: center;
    padding: 20px;
  }

  #podcast-cover img {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
  }

  #notes {
    width: 80%;
    margin: 30px auto;
    background-color: #f8f8f8;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
    text-align: center;
  }

  #notes textarea {
    width: 100%;
    height: 150px;
    border: none;
    background-color: #ffffff;
    font-family: Arial, sans-serif;
    font-size: 18px;
    color: #333;
    padding: 10px;
    resize: none;
    outline: none;
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
  }

  #save-button, #loop-button {
    background-color: #ff5500;
    color: #ffffff;
    border: none;
    border-radius: 5px;
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
    margin-top: 20px;
    transition: background-color 0.3s ease, transform 0.3s ease;
  }

  #save-button:hover, #loop-button:hover {
    background-color: #ff7700;
    transform: scale(1.05);
  }
</style>
</head>

<body>
  <div id="podcast-cover">
    <img src="cover.jpeg" alt="Podcast Cover">
  </div>

  <audio id="audiofile" src="test.mp3" controls></audio><br>

  <div id="subtitles"></div>

  <button id="loop-button">Loop Mode</button>

  <div id="notes">
    <textarea id="note-input" placeholder="方法"></textarea>
    <button id="save-button">丰富</button>
  </div>

  
  <script>
    (function(win, doc) {
      // JavaScript code

      var transcript = "昨天，中国金沙江上游川藏断国家水风光一体化示范基地，中国华电金沙江上游啦哇水电站正式启动大把浇注，这次浇筑混凝土面板堆石坝总填数量达1500万立方米，坝顶高程2709米，最大坝高239米，是目前世界最高面板最大项目，成功解决了堰塞湖城机身后覆盖层上住院等世界级技术难题，将为后续雅鲁藏布江下游等重大水电项目建设期中介进行业。进行业。";
       var syncData = 
      [{
        "endTime": "1.200",
        "startTime": "0",
        "word": "昨"
      }, {
        "endTime": "1.300",
        "startTime": "1.200",
        "word": "天"
      }, {
        "endTime": "1.800",
        "startTime": "1.300",
        "word": "中"
      }, {
        "endTime": "2",
        "startTime": "1.800",
        "word": "国"
      }, {
        "endTime": "2.300",
        "startTime": "2",
        "word": "金"
      }, {
        "endTime": "2.400",
        "startTime": "2.300",
        "word": "沙"
      }, {
        "endTime": "2.600",
        "startTime": "2.400",
        "word": "江"
      }, {
        "endTime": "2.800",
        "startTime": "2.600",
        "word": "上"
      }, {
        "endTime": "3",
        "startTime": "2.800",
        "word": "游"
      }, {
        "endTime": "3.400",
        "startTime": "3",
        "word": "川"
      }, {
        "endTime": "3.500",
        "startTime": "3.400",
        "word": "藏"
      }, {
        "endTime": "3.800",
        "startTime": "3.500",
        "word": "断"
      }, {
        "endTime": "4",
        "startTime": "3.800",
        "word": "国"
      }, {
        "endTime": "4.200",
        "startTime": "4",
        "word": "家"
      }, {
        "endTime": "4.400",
        "startTime": "4.200",
        "word": "水"
      }, {
        "endTime": "4.600",
        "startTime": "4.400",
        "word": "风"
      }, {
        "endTime": "4.700",
        "startTime": "4.600",
        "word": "光"
      }, {
        "endTime": "4.900",
        "startTime": "4.700",
        "word": "一"
      }, {
        "endTime": "5.100",
        "startTime": "4.900",
        "word": "体"
      }, {
        "endTime": "5.400",
        "startTime": "5.100",
        "word": "化"
      }, {
        "endTime": "5.600",
        "startTime": "5.400",
        "word": "示"
      }, {
        "endTime": "5.600",
        "startTime": "5.600",
        "word": "范"
      }, {
        "endTime": "5.800",
        "startTime": "5.600",
        "word": "基"
      }, {
        "endTime": "6",
        "startTime": "5.800",
        "word": "地"
      }, {
        "endTime": "6.600",
        "startTime": "6",
        "word": "中"
      }, {
        "endTime": "6.800",
        "startTime": "6.600",
        "word": "国"
      }, {
        "endTime": "7",
        "startTime": "6.800",
        "word": "华"
      }, {
        "endTime": "7.200",
        "startTime": "7",
        "word": "电"
      }, {
        "endTime": "7.500",
        "startTime": "7.200",
        "word": "金"
      }, {
        "endTime": "7.600",
        "startTime": "7.500",
        "word": "沙"
      }, {
        "endTime": "7.800",
        "startTime": "7.600",
        "word": "江"
      }, {
        "endTime": "8",
        "startTime": "7.800",
        "word": "上"
      }, {
        "endTime": "8.200",
        "startTime": "8",
        "word": "游"
      }, {
        "endTime": "8.400",
        "startTime": "8.200",
        "word": "啦"
      }, {
        "endTime": "8.600",
        "startTime": "8.400",
        "word": "哇"
      }, {
        "endTime": "8.900",
        "startTime": "8.600",
        "word": "水"
      }, {
        "endTime": "9.100",
        "startTime": "8.900",
        "word": "电"
      }, {
        "endTime": "9.200",
        "startTime": "9.100",
        "word": "站"
      }, {
        "endTime": "9.400",
        "startTime": "9.200",
        "word": "正"
      }, {
        "endTime": "9.600",
        "startTime": "9.400",
        "word": "式"
      }, {
        "endTime": "9.800",
        "startTime": "9.600",
        "word": "启"
      }, {
        "endTime": "9.900",
        "startTime": "9.800",
        "word": "动"
      }, {
        "endTime": "10.200",
        "startTime": "9.900",
        "word": "大"
      }, {
        "endTime": "10.400",
        "startTime": "10.200",
        "word": "把"
      }, {
        "endTime": "10.600",
        "startTime": "10.400",
        "word": "浇"
      }, {
        "endTime": "10.800",
        "startTime": "10.600",
        "word": "注"
      }, {
        "endTime": "11.200",
        "startTime": "10.800",
        "word": "这"
      }, {
        "endTime": "11.300",
        "startTime": "11.200",
        "word": "次"
      }, {
        "endTime": "11.700",
        "startTime": "11.300",
        "word": "浇"
      }, {
        "endTime": "11.800",
        "startTime": "11.700",
        "word": "筑"
      }, {
        "endTime": "12.200",
        "startTime": "11.800",
        "word": "混"
      }, {
        "endTime": "12.400",
        "startTime": "12.200",
        "word": "凝"
      }, {
        "endTime": "12.500",
        "startTime": "12.400",
        "word": "土"
      }, {
        "endTime": "12.800",
        "startTime": "12.500",
        "word": "面"
      }, {
        "endTime": "13.100",
        "startTime": "12.800",
        "word": "板"
      }, {
        "endTime": "13.200",
        "startTime": "13.100",
        "word": "堆"
      }, {
        "endTime": "13.500",
        "startTime": "13.200",
        "word": "石"
      }, {
        "endTime": "13.500",
        "startTime": "13.500",
        "word": "坝"
      }, {
        "endTime": "14.200",
        "startTime": "13.500",
        "word": "总"
      }, {
        "endTime": "14.500",
        "startTime": "14.200",
        "word": "填"
      }, {
        "endTime": "14.600",
        "startTime": "14.500",
        "word": "数"
      }, {
        "endTime": "14.800",
        "startTime": "14.600",
        "word": "量"
      }, {
        "endTime": "15",
        "startTime": "14.800",
        "word": "达"
      }, {
        "endTime": "15.200",
        "startTime": "15.200",
        "word": "一"
      }, {
        "endTime": "15.300",
        "startTime": "15.200",
        "word": "千"
      }, {
        "endTime": "15.500",
        "startTime": "15.300",
        "word": "五"
      }, {
        "endTime": "15.700",
        "startTime": "15.500",
        "word": "百"
      }, {
        "endTime": "15.900",
        "startTime": "15.700",
        "word": "万"
      }, {
        "endTime": "16.100",
        "startTime": "16.100",
        "word": "立"
      }, {
        "endTime": "16.200",
        "startTime": "16.100",
        "word": "方"
      }, {
        "endTime": "16.400",
        "startTime": "16.200",
        "word": "米"
      }, {
        "endTime": "17.100",
        "startTime": "16.400",
        "word": "坝"
      }, {
        "endTime": "17.400",
        "startTime": "17.100",
        "word": "顶"
      }, {
        "endTime": "17.500",
        "startTime": "17.400",
        "word": "高"
      }, {
        "endTime": "17.700",
        "startTime": "17.500",
        "word": "程"
      }, {
        "endTime": "18.100",
        "startTime": "18",
        "word": "两"
      }, {
        "endTime": "18.200",
        "startTime": "18.100",
        "word": "千"
      }, {
        "endTime": "18.300",
        "startTime": "18.200",
        "word": "七"
      }, {
        "endTime": "18.500",
        "startTime": "18.300",
        "word": "百"
      }, {
        "endTime": "18.600",
        "startTime": "18.500",
        "word": "零"
      }, {
        "endTime": "18.800",
        "startTime": "18.600",
        "word": "九"
      }, {
        "endTime": "19",
        "startTime": "18.900",
        "word": "米"
      }, {
        "endTime": "19.700",
        "startTime": "19",
        "word": "最"
      }, {
        "endTime": "19.900",
        "startTime": "19.700",
        "word": "大"
      }, {
        "endTime": "20.100",
        "startTime": "19.900",
        "word": "坝"
      }, {
        "endTime": "20.300",
        "startTime": "20.100",
        "word": "高"
      }, {
        "endTime": "20.600",
        "startTime": "20.600",
        "word": "两"
      }, {
        "endTime": "20.700",
        "startTime": "20.600",
        "word": "百"
      }, {
        "endTime": "21",
        "startTime": "20.700",
        "word": "三"
      }, {
        "endTime": "21.100",
        "startTime": "21",
        "word": "十"
      }, {
        "endTime": "21.200",
        "startTime": "21.100",
        "word": "九"
      }, {
        "endTime": "21.300",
        "startTime": "21.200",
        "word": "米"
      }, {
        "endTime": "22",
        "startTime": "21.300",
        "word": "是"
      }, {
        "endTime": "22.100",
        "startTime": "22",
        "word": "目"
      }, {
        "endTime": "22.300",
        "startTime": "22.100",
        "word": "前"
      }, {
        "endTime": "22.600",
        "startTime": "22.300",
        "word": "世"
      }, {
        "endTime": "22.700",
        "startTime": "22.600",
        "word": "界"
      }, {
        "endTime": "22.800",
        "startTime": "22.700",
        "word": "最"
      }, {
        "endTime": "23.100",
        "startTime": "22.800",
        "word": "高"
      }, {
        "endTime": "23.400",
        "startTime": "23.100",
        "word": "面"
      }, {
        "endTime": "23.700",
        "startTime": "23.400",
        "word": "板"
      }, {
        "endTime": "23.800",
        "startTime": "23.700",
        "word": "最"
      }, {
        "endTime": "24.200",
        "startTime": "23.800",
        "word": "大"
      }, {
        "endTime": "24.800",
        "startTime": "24.200",
        "word": "项"
      }, {
        "endTime": "24.800",
        "startTime": "24.800",
        "word": "目"
      }, {
        "endTime": "25.100",
        "startTime": "24.800",
        "word": "成"
      }, {
        "endTime": "25.300",
        "startTime": "25.100",
        "word": "功"
      }, {
        "endTime": "25.500",
        "startTime": "25.300",
        "word": "解"
      }, {
        "endTime": "25.600",
        "startTime": "25.500",
        "word": "决"
      }, {
        "endTime": "25.700",
        "startTime": "25.600",
        "word": "了"
      }, {
        "endTime": "26",
        "startTime": "25.700",
        "word": "堰"
      }, {
        "endTime": "26",
        "startTime": "26",
        "word": "塞"
      }, {
        "endTime": "26.100",
        "startTime": "26",
        "word": "湖"
      }, {
        "endTime": "26.600",
        "startTime": "26.100",
        "word": "城"
      }, {
        "endTime": "26.700",
        "startTime": "26.600",
        "word": "机"
      }, {
        "endTime": "27",
        "startTime": "26.700",
        "word": "身"
      }, {
        "endTime": "27.100",
        "startTime": "27",
        "word": "后"
      }, {
        "endTime": "27.500",
        "startTime": "27.100",
        "word": "覆"
      }, {
        "endTime": "27.600",
        "startTime": "27.500",
        "word": "盖"
      }, {
        "endTime": "27.900",
        "startTime": "27.600",
        "word": "层"
      }, {
        "endTime": "28.200",
        "startTime": "27.900",
        "word": "上"
      }, {
        "endTime": "28.300",
        "startTime": "28.200",
        "word": "住"
      }, {
        "endTime": "28.600",
        "startTime": "28.300",
        "word": "院"
      }, {
        "endTime": "28.700",
        "startTime": "28.600",
        "word": "等"
      }, {
        "endTime": "29",
        "startTime": "28.700",
        "word": "世"
      }, {
        "endTime": "29",
        "startTime": "29",
        "word": "界"
      }, {
        "endTime": "29.200",
        "startTime": "29",
        "word": "级"
      }, {
        "endTime": "29.500",
        "startTime": "29.200",
        "word": "技"
      }, {
        "endTime": "29.600",
        "startTime": "29.500",
        "word": "术"
      }, {
        "endTime": "29.900",
        "startTime": "29.600",
        "word": "难"
      }, {
        "endTime": "29.900",
        "startTime": "29.900",
        "word": "题"
      }, {
        "endTime": "30.700",
        "startTime": "29.900",
        "word": "将"
      }, {
        "endTime": "30.800",
        "startTime": "30.700",
        "word": "为"
      }, {
        "endTime": "31",
        "startTime": "30.800",
        "word": "后"
      }, {
        "endTime": "31.200",
        "startTime": "31",
        "word": "续"
      }, {
        "endTime": "31.400",
        "startTime": "31.200",
        "word": "雅"
      }, {
        "endTime": "31.500",
        "startTime": "31.400",
        "word": "鲁"
      }, {
        "endTime": "31.700",
        "startTime": "31.500",
        "word": "藏"
      }, {
        "endTime": "31.800",
        "startTime": "31.700",
        "word": "布"
      }, {
        "endTime": "31.900",
        "startTime": "31.800",
        "word": "江"
      }, {
        "endTime": "32.200",
        "startTime": "31.900",
        "word": "下"
      }, {
        "endTime": "32.300",
        "startTime": "32.200",
        "word": "游"
      }, {
        "endTime": "32.600",
        "startTime": "32.300",
        "word": "等"
      }, {
        "endTime": "32.900",
        "startTime": "32.600",
        "word": "重"
      }, {
        "endTime": "33",
        "startTime": "32.900",
        "word": "大"
      }, {
        "endTime": "33.300",
        "startTime": "33",
        "word": "水"
      }, {
        "endTime": "33.400",
        "startTime": "33.300",
        "word": "电"
      }, {
        "endTime": "33.700",
        "startTime": "33.400",
        "word": "项"
      }, {
        "endTime": "33.700",
        "startTime": "33.700",
        "word": "目"
      }, {
        "endTime": "34",
        "startTime": "33.700",
        "word": "建"
      }, {
        "endTime": "34",
        "startTime": "34",
        "word": "设"
      }, {
        "endTime": "34.300",
        "startTime": "34",
        "word": "期"
      }, {
        "endTime": "34.500",
        "startTime": "34.300",
        "word": "中"
      }, {
        "endTime": "34.800",
        "startTime": "34.500",
        "word": "介"
      }, {
        "endTime": "35",
        "startTime": "34.800",
        "word": "进"
      }, {
        "endTime": "35.100",
        "startTime": "35",
        "word": "行"
      }, {
        "endTime": "35.300",
        "startTime": "35.100",
        "word": "业"
      }, {
        "endTime": "36",
        "startTime": "35.300",
        "word": "进"
      }, {
        "endTime": "37.100",
        "startTime": "36",
        "word": "行"
      }, {
        "endTime": "39.300",
        "startTime": "37.100",
        "word": "业"
      } ]
    
;

      var syncData2 = []; // New array to track sentences
      // Convert syncData to syncData2
      var sentence = "";
      var startTime = "0";
      var endTime = "";
      var counter = 0;
  for (let i = 0; i < transcript.length; i++) {

    var word = syncData[counter].word;

    var punctuation = transcript[i + 1];
    while ((!isNaN(transcript[i]) ||[ "千", "万", "亿"].includes(transcript[i]) ||["零", "一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "百", "千", "万", "亿", "两"].
      includes(syncData[counter].word)) && transcript[i]!=word) {
      word = syncData[counter].word;

        if (["零", "一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "百", "千", "万", "亿", "两"].includes(syncData[counter].word) && (!isNaN(transcript[i]) || ["千", "万", "亿"].includes(transcript[i]))){
          
    
            sentence+=word;

            i++;
            counter++;
            word = syncData[counter].word;


        }
        else if(!isNaN(transcript[i])||[ "千", "万", "亿"].includes(transcript[i])){
          i++;
        }  
        else{
          word = syncData[counter].word;
            sentence+=word;
            counter++;
            console.log(syncData[counter].word);
           word = syncData[counter].word;
           punctuation = transcript[i + 1];

        }
       

    }

      if (["！", "，", "。"].includes(punctuation)) {
          sentence += word + "" + punctuation;
          endTime = syncData[counter-1].endTime;
          syncData2.push({
            startTime: startTime,
            endTime: endTime,
            sentence: sentence
          });
          sentence = "";
          startTime = "";
        i++;
        counter++;

     } 

      else if(startTime===""&& i!=0){
       startTime = syncData[counter-1].startTime;
       sentence+=word;
        counter++
      }
      else{
        sentence+=word;
       counter++;
      } 

  }

     
  var audioPlayer = doc.getElementById("audiofile");
    var subtitles = doc.getElementById("subtitles");
    var loopButton = doc.getElementById("loop-button");

    var currentSubtitleIndex = 0;
    var maxCharacters = 50;

    function displaySubtitles() {
    	console.log("ds");
      subtitles.innerHTML = ""; // clear existing subtitles
      var charactersShown = 0;
      for (var i = currentSubtitleIndex; i < syncData2.length; i++) {
        if ((charactersShown + syncData2[i].sentence.length) <= maxCharacters) {
          var element = doc.createElement('span');
          element.setAttribute("id", "s_" + i);
          element.innerText = syncData2[i].sentence;
          subtitles.appendChild(element);
          charactersShown += syncData2[i].sentence.length;
          console.log("d");
        } else {
        	console.log("e");
          break;
        }
      }
    }

    displaySubtitles();

   audioPlayer.addEventListener("timeupdate", function(e) {
    syncData2.forEach(function(element, index) {
      var sentenceElement = doc.getElementById("s_" + index);
      console.log(sentenceElement);
      if (
        audioPlayer.currentTime >= parseFloat(element.startTime) &&
        audioPlayer.currentTime <= parseFloat(element.endTime)
      ) {
        if (sentenceElement) {
          sentenceElement.style.color = '#E4E4E4';
          sentenceElement.style.fontWeight = 'bold';
        }
        if (index >= (currentSubtitleIndex) || index <= (currentSubtitleIndex)) {
          currentSubtitleIndex = index;
          console.log("dd");
          displaySubtitles();
        }
      } else if (sentenceElement) {
        sentenceElement.style.color = '#595757';
        sentenceElement.style.fontWeight = 'normal';
      }
    });
  });
    // Variable to store the selected highlighted text
   var selectedText = "";
  var loopingInterval = null;
  var isLoopMode = false; // Initialize loop mode as false
  
  loopButton.addEventListener("click", function() {
    isLoopMode = !isLoopMode; // Toggle loop mode

    if (!isLoopMode && loopingInterval) {
      // Stop the current loop and let the audio play normally
      clearInterval(loopingInterval);
      loopingInterval = null;
      selectedText = "";
    }

    loopButton.textContent = isLoopMode ? "Loop Mode: ON" : "Loop Mode: OFF"; // Update button text based on loop mode status
  });

 subtitles.addEventListener("mouseup", function() {
    if (isLoopMode) {
        var selection = window.getSelection();
        selectedText = selection.toString().trim();
        
        // Find start and end time for selected text
        var startLoopTime = null;
        var endLoopTime = null;
        var selectedTextIndex = 0;

        for (var i = 0; i < syncData.length; i++) {
            var currentWord = syncData[i].word;
            var currentWordIndex = 0;

            while (currentWordIndex < currentWord.length && selectedTextIndex < selectedText.length) {
                if (currentWord[currentWordIndex] === selectedText[selectedTextIndex]) {
                    if (selectedTextIndex === 0) { // The start of selected text
                        startLoopTime = parseFloat(syncData[i].startTime);
                    }
                    if (selectedTextIndex === selectedText.length - 1) { // The end of selected text
                        endLoopTime = parseFloat(syncData[i].endTime);
                        break;
                    }
                    currentWordIndex++;
                    selectedTextIndex++;
                } else {
                    currentWordIndex = currentWord.length; // Skip this word as it's not part of the selected text
                }
            }

            if (endLoopTime !== null) {
                break;
            }
        }

        // Loop the selected text
        if (startLoopTime !== null && endLoopTime !== null) {
            audioPlayer.currentTime = startLoopTime;
            audioPlayer.play();

            if (loopingInterval) {
                clearInterval(loopingInterval);
            }

            loopingInterval = setInterval(function() {
                if (audioPlayer.currentTime >= endLoopTime) {
                    audioPlayer.currentTime = startLoopTime;
                }
            }, 100);
        }
    }
});
})(window, document);
</script>
</body>