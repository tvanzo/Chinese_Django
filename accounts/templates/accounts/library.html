{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" type="image/svg+xml" href="{% static 'accounts/img/ele.png' %}">
  <title>Chinese Log</title>

  <!-- Fonts and Icons -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <link href="{% static 'accounts/css/nucleo-icons.css' %}" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link href="{% static 'accounts/css/nucleo-svg.css' %}" rel="stylesheet" />

  <!-- Soft UI -->
  <link href="{% static 'accounts/css/soft-ui-dashboard.css' %}" rel="stylesheet" />

  <style>
    /* =========================================================
      Modern + Minimal theme (keeps your structure, simplifies visuals)
      - less gradients, less shadows, more whitespace
      - crisp chips + buttons
      - cards become clean “tiles”
    ========================================================= */

    :root{
      --bg: #f7f8fb;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --border: rgba(15, 23, 42, 0.08);

      --primary: #3a9fff;
      --primary-weak: rgba(58, 159, 255, 0.12);
      --accent: #cb0ba0;
      --accent-weak: rgba(203, 11, 160, 0.12);

      --radius: 14px;
      --radius-sm: 10px;

      --shadow-sm: 0 6px 18px rgba(15, 23, 42, 0.06);
      --shadow-md: 0 12px 28px rgba(15, 23, 42, 0.10);

      --ring: 0 0 0 4px rgba(58, 159, 255, 0.18);
    }

    body{
      font-family: "Open Sans", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .container-fluid{
      max-width: 1200px;
      padding: 1.5rem 1rem;
    }

    /* Header row */
    .page-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 1rem;
      margin-bottom: 1.25rem;
    }

    /* Filter chips */
    .filter-group{
      display:flex;
      gap: .5rem;
      padding: .35rem;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
      flex-wrap: wrap;
    }

    .btn-filter{
      border: 1px solid transparent;
      background: transparent;
      color: var(--muted);
      padding: .55rem .8rem;
      border-radius: 999px;
      font-weight: 600;
      font-size: .875rem;
      display:flex;
      align-items:center;
      gap: .5rem;
      cursor:pointer;
      transition: background .18s ease, color .18s ease, border-color .18s ease;
      user-select: none;
    }

    .btn-filter:hover{
      background: rgba(15, 23, 42, 0.04);
      color: var(--text);
    }

    .btn-filter.active{
      background: var(--primary-weak);
      color: var(--text);
      border-color: rgba(58, 159, 255, 0.25);
    }

    .btn-count{
      min-width: 22px;
      height: 22px;
      padding: 0 7px;
      border-radius: 999px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size: .75rem;
      font-weight: 700;
      background: rgba(15, 23, 42, 0.06);
      color: var(--muted);
    }

    .btn-filter.active .btn-count{
      background: rgba(58, 159, 255, 0.20);
      color: #0b1b3a;
    }

    /* Actions */
    .action-buttons{
      display:flex;
      gap: .6rem;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .btn-download{
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      padding: .65rem .9rem;
      border-radius: 999px;
      font-weight: 700;
      font-size: .875rem;
      display:flex;
      align-items:center;
      gap:.55rem;
      cursor:pointer;
      transition: transform .18s ease, box-shadow .18s ease, background .18s ease, border-color .18s ease;
      box-shadow: var(--shadow-sm);
      white-space: nowrap;
    }

    .btn-download svg{
      width: 18px;
      height: 18px;
    }

    .btn-download:hover{
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
      border-color: rgba(15, 23, 42, 0.14);
    }

    .btn-download.primary{
      background: var(--primary);
      border-color: rgba(58, 159, 255, 0.55);
      color: #fff;
      box-shadow: 0 10px 25px rgba(58,159,255,.22);
    }

    .btn-download.primary:hover{ box-shadow: 0 14px 30px rgba(58,159,255,.28); }

    .btn-download.secondary{
      background: #fff;
      color: var(--text);
    }

    .btn-download.secondary:focus-visible{
      outline: none;
      box-shadow: var(--ring), var(--shadow-sm);
    }

    /* Grid */
    .video-grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.25rem;
    }

    /* Card */
    .achievement-badge{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      height: 100%;
    }

    .achievement-badge:hover{
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      border-color: rgba(15, 23, 42, 0.14);
    }

    .badge-link{
      text-decoration:none;
      color: inherit;
      display:block;
      height:100%;
    }

    /* Banner */
    .badge-banner{
      position:relative;
      height: 150px;
      overflow:hidden;
      background: #0b1220;
    }

    .badge-img{
      width:100%;
      height:100%;
      object-fit: cover;
      transform: scale(1.02);
      transition: transform .25s ease;
      filter: saturate(1.02) contrast(1.02);
    }

    .achievement-badge:hover .badge-img{ transform: scale(1.06); }

    .badge-overlay{
      position:absolute;
      inset:0;
      background: linear-gradient(to top, rgba(0,0,0,.58), rgba(0,0,0,.10) 55%, rgba(0,0,0,0));
      pointer-events:none;
    }

    /* Center icon becomes simpler */
    .badge-icon{
      position:absolute;
      left: .9rem;
      top: .9rem;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(255,255,255,.35);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 24px rgba(0,0,0,.18);
      z-index: 2;
    }
    .badge-icon svg{ width: 22px; height: 22px; }
    .badge-icon svg path{ fill: var(--text); }

    /* Stats chips bottom */
    .badge-stats{
      position:absolute;
      bottom: .8rem;
      left: .8rem;
      right: .8rem;
      display:flex;
      justify-content: space-between;
      gap: .5rem;
      z-index: 2;
      color: #fff;
    }

    .stat{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      padding: .38rem .55rem;
      border-radius: 999px;
      font-weight: 700;
      font-size: .75rem;
      background: rgba(255,255,255,.16);
      border: 1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(8px);
      line-height: 1;
    }

    .stat svg{
      width: 14px;
      height: 14px;
      fill: #fff;
      opacity: .95;
    }

    /* Content */
    .badge-content{
      padding: 1rem 1rem 1.05rem;
      display:flex;
      flex-direction: column;
      height: calc(100% - 150px);
      gap: .55rem;
    }

    .badge-title{
      font-size: 1rem;
      font-weight: 800;
      margin: 0;
      line-height: 1.35;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .badge-description{
      margin: 0;
      color: var(--muted);
      font-size: .875rem;
      line-height: 1.55;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }

    /* Progress */
    .badge-progress{
      width:100%;
      height: 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.06);
      overflow:hidden;
      margin-top: .1rem;
    }

    .progress-bar{
      height:100%;
      border-radius: 999px;
      background: var(--primary);
      transition: width .35s ease;
    }

    /* Footer */
    .badge-footer{
      display:flex;
      align-items:center;
      justify-content: space-between;
      margin-top: auto;
      padding-top: .65rem;
      border-top: 1px solid rgba(15, 23, 42, 0.06);
      gap: .75rem;
    }

    .badge-channel{
      font-size: .825rem;
      color: var(--muted);
      font-weight: 700;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 60%;
    }

    .status-badge{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      padding: .35rem .6rem;
      border-radius: 999px;
      font-size: .75rem;
      font-weight: 800;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      white-space: nowrap;
    }

    .status-badge.in-progress{
      background: var(--primary-weak);
      border-color: rgba(58, 159, 255, 0.20);
      color: #0b1b3a;
    }

    .status-badge.completed{
      background: var(--accent-weak);
      border-color: rgba(203, 11, 160, 0.18);
      color: #3a0030;
    }

    /* Remove the old "Completed" corner badge (optional) */
    .completed-badge{ display:none; }

    /* =========================================================
      Study Guide Popup - minimal
    ========================================================= */
    #study-guide-overlay{
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.55);
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s ease;
      z-index: 999;
    }
    #study-guide-overlay.active{
      opacity: 1;
      pointer-events: auto;
    }

    #study-guide-popup{
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(.98);
      width: min(420px, calc(100% - 32px));
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow-md);
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s ease, transform .2s ease;
      z-index: 1000;
      padding: 18px;
    }

    #study-guide-popup.active{
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -50%) scale(1);
    }

    .popup-header{
      display:flex;
      align-items:center;
      gap: .65rem;
      justify-content:flex-start;
      margin-bottom: .5rem;
    }
    .popup-title{
      margin: 0;
      font-size: 1rem;
      font-weight: 900;
      color: var(--text);
    }
    .popup-message{
      margin: .35rem 0 1rem;
      color: var(--muted);
      font-size: .9rem;
      line-height: 1.55;
      text-align:left;
    }
    .button-container{
      display:flex;
      gap: .6rem;
      justify-content:flex-end;
    }

    .upgrade-button,
    .close-button{
      border-radius: 999px;
      padding: .6rem .85rem;
      font-weight: 800;
      font-size: .875rem;
      cursor:pointer;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
    }

    .upgrade-button{
      background: var(--primary);
      color: #fff;
      border-color: rgba(58,159,255,.55);
      box-shadow: 0 10px 25px rgba(58,159,255,.22);
    }
    .upgrade-button:hover{ transform: translateY(-1px); box-shadow: 0 14px 30px rgba(58,159,255,.28); }
    .close-button:hover{ background: rgba(15,23,42,.04); transform: translateY(-1px); }

    .warning-icon svg{
      width: 20px;
      height: 20px;
      color: var(--muted);
    }

    /* Download notification (keep but make cleaner) */
    #download-notification{
      background: rgba(255,255,255,.92);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-sm);
      backdrop-filter: blur(10px);
      padding: 10px 14px;
      font-size: 14px;
      width: calc(100% - 24px);
      margin: 12px auto 0;
      left: 0;
      right: 0;
      border-radius: 12px;
      position: fixed;
      top: 0;
      z-index: 1060;
      opacity: 0;
      transition: opacity .2s ease;
      display: none;
      text-align:center;
      color: var(--text);
    }
    #download-notification.show{
      opacity: 1;
      display: block;
    }

    /* =========================================================
      Soft UI Sidebar Fix — keep yours (slightly tightened)
    ========================================================= */
    body.g-sidenav-show .main-content{ transition: margin-left .2s ease; }
    body.g-sidenav-show:not(.g-sidenav-hidden) .main-content{ margin-left: 18rem !important; }
    body.g-sidenav-show.g-sidenav-pinned .main-content,
    body.g-sidenav-show.g-sidenav-hidden .main-content,
    body.g-sidenav-show.navbar-vertical-collapsed .main-content{ margin-left: 6.5rem !important; }

    #sidenav-main,
    .sidenav.navbar-vertical{
      background: #fff !important;
      border: 1px solid var(--border) !important;
      box-shadow: var(--shadow-sm) !important;
      border-radius: 16px !important;
      margin: 16px !important;
      height: calc(100vh - 32px) !important;
      overflow: hidden !important;
    }
    #sidenav-scrollbar{ height: 100% !important; }
    #sidenav-main .navbar-collapse{
      height: calc(100% - 72px) !important;
      overflow-y: auto !important;
    }
    body.g-sidenav-pinned #sidenav-main,
    body.navbar-vertical-collapsed #sidenav-main{ width: 5.5rem !important; }

    body.g-sidenav-pinned #sidenav-main .navbar-brand span,
    body.navbar-vertical-collapsed #sidenav-main .navbar-brand span{
      opacity: 0 !important;
      width: 0 !important;
      overflow: hidden !important;
    }

    @media (max-width: 991.98px){
      body.g-sidenav-show .main-content{ margin-left: 0 !important; }
      #sidenav-main,
      .sidenav.navbar-vertical{
        margin: 0 !important;
        border-radius: 0 !important;
        height: 100vh !important;
      }
    }

    /* Mobile header layout */
    @media (max-width: 768px){
      .page-header{
        flex-direction: column;
        align-items: stretch;
      }
      .action-buttons{
        justify-content: stretch;
      }
      .btn-download{
        flex: 1;
        justify-content: center;
      }
      .video-grid{ gap: 1rem; }
      .badge-banner{ height: 140px; }
      .badge-content{ padding: .95rem; }
    }
  </style>
</head>

<body class="g-sidenav-show bg-gray-100">
  {% include 'accounts/navbar.html' %}
  {% include 'accounts/sidebar.html' %}

  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
    <div id="download-notification" role="alert">
      <span>Your study guide is downloading. This may take a couple of minutes...</span>
    </div>

    <div class="container-fluid py-4">
      <div class="page-header">
        <div class="filter-group">
          <button class="btn-filter active" onclick="filterVideos('all', this)">
            <span>All</span>
            <span class="btn-count">{{ all_media_count }}</span>
          </button>
          <button class="btn-filter" onclick="filterVideos('in_progress', this)">
            <span>In Progress</span>
            <span class="btn-count">{{ in_progress_count }}</span>
          </button>
          <button class="btn-filter" onclick="filterVideos('completed', this)">
            <span>Completed</span>
            <span class="btn-count">{{ completed_count }}</span>
          </button>
        </div>

        <div class="action-buttons">
          <button class="btn-download primary" onclick="downloadSubtitles()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            <span>Subtitles</span>
          </button>

          <button class="btn-download secondary" id="study-guide-btn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <line x1="10" y1="9" x2="8" y2="9"></line>
            </svg>
            <span>Study Guide</span>
          </button>
        </div>
      </div>

      <div class="video-grid" id="video-list">
        {% if media %}
          {% for video in media %}
          <div class="achievement-badge" data-status="{{ video.status|default:'all' }}">
            <a href="{% url 'video_detail' video.media_id %}" class="badge-link">
              <div class="badge-banner">
                <img src="{{ video.thumbnail_url }}" alt="{{ video.title }}" class="badge-img">
                <div class="badge-overlay"></div>

                <div class="badge-icon" aria-hidden="true">
                  {% if video.status == 'completed' %}
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                    </svg>
                  {% else %}
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M10.9965 4.00001C11.4368 3.99846 11.8263 4.28508 11.9558 4.70591L15.1231 14.9997L18.0715 7.62861C18.1964 7.31651 18.4697 7.08801 18.7989 7.02042C19.1282 6.95284 19.4694 7.0552 19.7071 7.29289L22.7071 10.2929C23.0976 10.6834 23.0976 11.3166 22.7071 11.7071C22.3166 12.0976 21.6834 12.0976 21.2929 11.7071L19.3652 9.77946L15.9285 18.3714C15.771 18.765 15.3826 19.0165 14.959 18.9992C14.5355 18.9818 14.1689 18.6992 14.0442 18.2941L11.0121 8.43973L8.95782 15.2873C8.84938 15.6488 8.54667 15.9185 8.17511 15.9845C7.80355 16.0506 7.42643 15.9019 7.2 15.6L5 12.6667L2.8 15.6C2.46863 16.0418 1.84183 16.1314 1.4 15.8C0.95817 15.4686 0.868627 14.8418 1.2 14.4L4.2 10.4C4.38885 10.1482 4.68524 10 5 10C5.31475 10 5.61114 10.1482 5.8 10.4L7.6114 12.8152L10.0422 4.71265C10.1687 4.29092 10.5562 4.00156 10.9965 4.00001Z"
                        fill="none" stroke="currentColor" stroke-width="2"/>
                    </svg>
                  {% endif %}
                </div>

                <div class="badge-stats">
                  <span class="stat">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                    </svg>
                    {{ video.user_highlights_count }}
                  </span>
                  <span class="stat">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <circle cx="12" cy="12" r="10"/>
                      <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    {{ video.formatted_video_length }}
                  </span>
                </div>
              </div>

              <div class="badge-content">
                <h3 class="badge-title">{{ video.title }}</h3>
                <p class="badge-description">{{ video.description|truncatechars:100 }}</p>

                <div class="badge-progress" aria-hidden="true">
                  <div class="progress-bar" style="width: {{ video.progress_percent }}%;"></div>
                </div>

                <div class="badge-footer">
                  <span class="badge-channel">{{ video.channel.name }}</span>
                  <span class="status-badge {{ video.status|default:'in-progress' }}">
                    {% if video.status == 'completed' %}
                      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 6L9 17L4 12"/>
                      </svg>
                      Completed
                    {% else %}
                      <svg viewBox="0 0 24 24" width="12" height="12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                          d="M10.9965 4.00001C11.4368 3.99846 11.8263 4.28508 11.9558 4.70591L15.1231 14.9997L18.0715 7.62861C18.1964 7.31651 18.4697 7.08801 18.7989 7.02042C19.1282 6.95284 19.4694 7.0552 19.7071 7.29289L22.7071 10.2929C23.0976 10.6834 23.0976 11.3166 22.7071 11.7071C22.3166 12.0976 21.6834 12.0976 21.2929 11.7071L19.3652 9.77946L15.9285 18.3714C15.771 18.765 15.3826 19.0165 14.959 18.9992C14.5355 18.9818 14.1689 18.6992 14.0442 18.2941L11.0121 8.43973L8.95782 15.2873C8.84938 15.6488 8.54667 15.9185 8.17511 15.9845C7.80355 16.0506 7.42643 15.9019 7.2 15.6L5 12.6667L2.8 15.6C2.46863 16.0418 1.84183 16.1314 1.4 15.8C0.95817 15.4686 0.868627 14.8418 1.2 14.4L4.2 10.4C4.38885 10.1482 4.68524 10 5 10C5.31475 10 5.61114 10.1482 5.8 10.4L7.6114 12.8152L10.0422 4.71265C10.1687 4.29092 10.5562 4.00156 10.9965 4.00001Z"
                          fill="none" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      In Progress
                    {% endif %}
                  </span>
                </div>
              </div>
            </a>
          </div>
          {% endfor %}
        {% else %}
          <div class="col-12 text-center py-5">
            <p>No videos found.</p>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Study Guide Popup -->
    <div id="study-guide-popup" class="limit-popup" role="dialog" aria-modal="true">
      <div class="popup-content">
        <div class="popup-header">
          <div class="warning-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
              <line x1="12" y1="9" x2="12" y2="13"></line>
              <line x1="12" y1="17" x2="12" y2="17"></line>
            </svg>
          </div>
          <h3 class="popup-title">Download your study guide</h3>
        </div>
        <p class="popup-message">We’ll generate a PDF from all your highlights and start the download.</p>
        <div class="button-container">
          <button class="upgrade-button" onclick="downloadStudyGuide()">Download</button>
          <button class="close-button" onclick="hideStudyGuidePopup()">Cancel</button>
        </div>
      </div>
    </div>
    <div id="study-guide-overlay" class="overlay"></div>
  </main>

  <!-- Core JS Files -->
  <script src="{% static 'accounts/js/core/popper.min.js' %}"></script>
  <script src="{% static 'accounts/js/core/bootstrap.min.js' %}"></script>
  <script src="{% static 'accounts/js/plugins/perfect-scrollbar.min.js' %}"></script>
  <script src="{% static 'accounts/js/plugins/smooth-scrollbar.min.js' %}"></script>
  <script src="{% static 'accounts/js/soft-ui-dashboard.min.js?v=1.0.7' %}"></script>

  {% csrf_token %}

  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = { damping: '0.5' };
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }

    function filterVideos(status, element) {
      const videos = document.querySelectorAll('.achievement-badge');
      videos.forEach(video => {
        if (status === 'all' || video.getAttribute('data-status') === status) {
          video.style.display = 'block';
        } else {
          video.style.display = 'none';
        }
      });
      const buttons = document.querySelectorAll('.btn-filter');
      buttons.forEach(button => button.classList.remove('active'));
      element.classList.add('active');
    }

    function downloadSubtitles() {
      const url = "{% url 'download_subtitles' %}";
      const link = document.createElement('a');
      link.href = url;
      link.download = 'combined_subtitles.txt';
      link.click();
    }

    function generateAllHighlightsStudyGuide() {
      const url = "{% url 'generate_all_highlights_study_guide' %}";
      const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

      fetch(url, {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrfToken,
          'Accept': 'application/pdf'
        }
      })
      .then(response => {
        if (!response.ok) throw new Error('Network response was not ok: ' + response.statusText);
        return response.blob();
      })
      .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'all_highlights_study_guide.pdf';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        window.URL.revokeObjectURL(url);
      })
      .catch(error => {
        console.error('Error generating study guide:', error);
        alert('Failed to generate study guide. Please try again.');
      });
    }

    function showStudyGuidePopup() {
      document.getElementById('study-guide-popup').classList.add('active');
      document.getElementById('study-guide-overlay').classList.add('active');
    }

    function hideStudyGuidePopup() {
      document.getElementById('study-guide-popup').classList.remove('active');
      document.getElementById('study-guide-overlay').classList.remove('active');
    }

    function downloadStudyGuide() {
      const notification = document.getElementById('download-notification');
      notification.style.display = 'block';
      notification.classList.add('show');

      generateAllHighlightsStudyGuide();

      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => { notification.style.display = 'none'; }, 200);
      }, 2500);

      hideStudyGuidePopup();
    }

    document.getElementById('study-guide-btn').addEventListener('click', function(event) {
      event.preventDefault();
      showStudyGuidePopup();
    });

    document.getElementById('study-guide-overlay').addEventListener('click', hideStudyGuidePopup);
  </script>
</body>
</html>
