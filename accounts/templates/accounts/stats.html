<!--
=========================================================
* Soft UI Dashboard - v1.0.7
=========================================================

* Product Page: https://www.creative-tim.com/product/soft-ui-dashboard
* Copyright 2023 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" type="image/svg+xml" href="{% static 'accounts/img/ele.png' %}">
  <title>Chinese Log</title>

  <!-- Fonts and icons -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <link href="{% static 'accounts/css/nucleo-icons.css' %}" rel="stylesheet" />
  <link href="{% static 'accounts/css/nucleo-svg.css' %}" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>

  <!-- CSS Files -->
  <link id="pagestyle" href="{% static 'accounts/css/soft-ui-dashboard.css' %}" rel="stylesheet" />

  <!-- Nepcha Analytics -->
  <script defer data-site="YOUR_DOMAIN_HERE" src="https://api.nepcha.com/js/nepcha-analytics.js"></script>

  <style>
    html, body {
      width: 100%;
      overflow-x: hidden;
    }

    body { transition: padding-top 0.3s ease-in-out; }

    .text-warning { color: #dcb234; }
    .text-success { color: #3c763d; }

    .title-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      height: 50px;
    }
    .title-container p {
      margin: 0;
      line-height: 1.1;
      text-align: center;
      white-space: pre-line;
      font-size: 0.75rem;
    }

    .nav-link.active .icon svg {
      fill: #FFD700 !important;
      color: #FFD700 !important;
    }

    .xp-points-bar {
      background-color: #f8f9fa;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    .xp-points-bar h2 { margin: 0; font-size: 24px; font-weight: normal; }
    .xp-points-bar #xp-points { font-size: 20px; font-weight: bold; color: #007bff; }

    .xp-circle {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: #ffc40c;
      color: #ffffff;
      font-weight: bold;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #xp-points { font-size: 14px; font-weight: bold; color: #ffffff; }

    .btn-purple { background-color: #d00c9c; color: #ffffff; border-color: #6f42c1; }
    .compact-btn { padding: 0.25rem 0.5rem; }

    #unique-xp-display {
      background-color: #d00c9c;
      color: white;
      padding: 3px 8px;
      border-radius: 8px;
    }
    #unique-xp-display .unique-xp-circle {
      background-color: #ffc40c;
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 5px;
    }
    #unique-xp-points { font-weight: bold; font-size: 14px; }

    #sidenav-main {
      background-color: #ffffff;
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      max-height: calc(100vh - 40px);
      overflow-y: auto;
    }

    #welcome-banner {
      background-color: #f8f9fa;
      color: #344767;
      border: none;
      border-bottom: 2px solid #e9ecef;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      padding: 10px 15px;
      font-size: 14px;
      width: 100%;
      text-align: left;
    }
    #welcome-banner .close {
      background: transparent;
      border: none;
      color: #6c757d;
      padding: 0;
      font-size: 20px;
      line-height: 1;
      opacity: 0.5;
      transition: opacity 0.15s ease-in-out;
    }
    #welcome-banner .close:hover { opacity: 1; }
    #welcome-banner .close:focus { outline: none; box-shadow: none; }

    .sidenav-header {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100px;
    }
    .custom-logo-size { height: 50px !important; }

    @media (max-width: 991.98px) {
      .main-content,
      .g-sidenav-show .main-content {
        margin-left: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
      }

      .container-fluid, .card, .card-body, .table-responsive {
        max-width: 100%;
      }

      .table-responsive {
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch;
      }
      table {
        min-width: 700px;
      }
    }
  </style>
</head>

<body class="g-sidenav-show bg-gray-100">

  {% if messages %}
  <div id="welcome-banner" class="alert alert-light fade show fixed-top" role="alert" style="z-index: 1060;">
    <div class="container-fluid py-2">
      <div class="d-flex align-items-center justify-content-between">
        {% for message in messages %}
          {% if forloop.last %}
            {{ message }}
          {% endif %}
        {% endfor %}
        <button type="button" class="close" data-bs-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">Ã—</span>
        </button>
      </div>
    </div>
  </div>
  {% endif %}

  {% include 'accounts/navbar.html' %}
  {% include 'accounts/sidebar.html' %}

  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
    <div class="container-fluid py-4">
      <div class="row">
        <!-- Total Highlights -->
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">Total Highlights</p>
                    <h5 class="font-weight-bolder mb-0" id="total-highlights">Loading...</h5>
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape shadow text-center border-radius-md" style="width: 48px; height: 48px; background: none;">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: 100%;">
                      <path d="M18.4834 16.7674C17.8471 16.9195 17.1829 17 16.5 17C11.8056 17 8 13.1944 8 8.50001C8 8.01653 8.04036 7.54249 8.11791 7.08105C8.08172 7.11586 8.04432 7.14792 8.00494 7.17781C7.72433 7.39083 7.37485 7.46991 6.67589 7.62806L6.03954 7.77204C3.57986 8.32856 2.35002 8.60682 2.05742 9.54774C1.76482 10.4887 2.60325 11.4691 4.2801 13.4299L4.71392 13.9372C5.19042 14.4944 5.42868 14.773 5.53586 15.1177C5.64305 15.4624 5.60703 15.8341 5.53498 16.5776L5.4694 17.2544C5.21588 19.8706 5.08912 21.1787 5.85515 21.7602C6.62117 22.3417 7.77267 21.8116 10.0757 20.7512L10.6715 20.4768C11.3259 20.1755 11.6531 20.0249 12 20.0249C12.3469 20.0249 12.6741 20.1755 13.3285 20.4768L13.9243 20.7512C16.2273 21.8116 17.3788 22.3417 18.1449 21.7602C18.9109 21.1787 18.7841 19.8706 18.5306 17.2544L18.4834 16.7674Z" fill="#FFC10D"></path>
                      <path opacity="0.5" d="M9.15302 5.40838L8.82532 5.99623C8.46538 6.64194 8.28541 6.96479 8.0048 7.17781C8.04418 7.14791 8.08158 7.11586 8.11777 7.08105C8.04022 7.54249 7.99986 8.01653 7.99986 8.50001C7.99986 13.1944 11.8054 17 16.4999 17C17.1828 17 17.8469 16.9195 18.4833 16.7674L18.4649 16.5776C18.3928 15.8341 18.3568 15.4624 18.464 15.1177C18.5712 14.773 18.8094 14.4944 19.2859 13.9372L19.7198 13.4299C21.3966 11.4691 22.235 10.4886 21.9424 9.54773C21.6498 8.60682 20.42 8.32856 17.9603 7.77203L17.324 7.62805C16.625 7.4699 16.2755 7.39083 15.9949 7.17781C15.7143 6.96479 15.5343 6.64194 15.1744 5.99624L14.8467 5.40837C13.58 3.13612 12.9467 2 11.9999 2C11.053 2 10.4197 3.13613 9.15302 5.40838Z" fill="#FFC10D"></path>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Total Minutes -->
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">Total Minutes</p>
                    <h5 class="font-weight-bolder mb-0" id="total-minutes">Loading...</h5>
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape shadow text-center border-radius-md" style="width: 48px; height: 48px; background: none;">
                    <svg viewBox="0 0 24 24" fill="#2ca9bc" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: 100%;">
                      <path d="M12 17V12L14.5 10.5M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Streak -->
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">Streak</p>
                    <h5 class="font-weight-bolder mb-0" id="streak">Loading...</h5>
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape shadow text-center border-radius-md" style="width: 48px; height: 48px; background: none;">
                    <svg viewBox="0 0 392.598 392.598" xmlns="http://www.w3.org/2000/svg" fill="currentColor" style="width: 100%; height: 100%;">
                      <path fill="#FFC10D" d="M225.887,22.105c-53.269,0-79.644,22.238-100.978,84.945c-0.388,1.164-1.034,2.263-1.681,3.168 c-28.121,35.879-93.867,139.378-62.836,189.479c6.4,6.788,69.301,71.176,159.03,71.176c29.802,0,59.798-7.111,89.277-21.075 c10.602-2.715,21.075-3.038,31.612-0.453v-128.97c-7.499,5.495-15.838,12.024-24.889,19.653c-5.236,4.59-13.576,2.457-16.679-3.426 c-40.598-41.18-82.941-38.271-126.901,1.487l-10.214,12.347c-10.408,11.313-24.63-2.392-16.743-13.899l10.408-12.671l0,0 c0,0,0-0.065,0.065-0.065c0.388-0.453,11.572-15.192,5.301-46.545c-3.297-16.873-4.396-31.935-3.232-46.028 c0.905-11.572,3.879-46.933,26.634-47.127c22.949-0.259,42.085-4.461,56.954-12.671c14.222-7.822,18.554-24.566,12.541-38.659 C247.738,19.454,225.887,22.105,225.887,22.105z"/>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Total Videos -->
        <div class="col-xl-3 col-sm-6">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">Total Videos</p>
                    <h5 class="font-weight-bolder mb-0" id="total-videos">Loading...</h5>
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape shadow text-center border-radius-md" style="width: 48px; height: 48px; background: none;">
                    <svg fill="#000000" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: 100%;">
                      <polyline points="21 5 12 14 8 10" style="fill: none; stroke: #2ca9bc; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"></polyline>
                      <path d="M21,11v9a1,1,0,0,1-1,1H4a1,1,0,0,1-1-1V4A1,1,0,0,1,4,3H16" style="fill: none; stroke: #000000; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"></path>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div><!-- /.row -->

      <div class="row mt-4">
        <div class="col-lg-5 mb-lg-0 mb-4">
          <div class="card z-index-2">
            <div class="card-body p-3">
              <div class="bg-gradient-dark border-radius-lg py-3 pe-1 mb-3">
                <div class="chart">
                  <canvas id="highlightBarChart" class="chart-canvas" height="170"></canvas>
                </div>
              </div>
              <h6 class="ms-2 mt-4 mb-0">Progress Tracker</h6>
              <div class="container border-radius-lg">
                <div class="row">

                  <div class="col-4 py-3 ps-0">
                    <div class="d-flex mb-2">
                      <div class="icon icon-shape icon-xxs shadow border-radius-sm bg-gradient-primary text-center me-2 d-flex align-items-center justify-content-center"></div>
                      <p class="text-xs mt-1 mb-0 font-weight-bold">Points</p>
                    </div>
                    <h4 class="font-weight-bolder">{{ total_points }}</h4>
                    <div class="progress w-75">
                      <div class="progress-bar bg-dark w-60" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>

                  <div class="col-4 py-3 ps-0">
                    <div class="d-flex mb-2">
                      <div class="icon icon-shape icon-xxs shadow text-center me-2 d-flex align-items-center justify-content-center" title="Total Words Consumed">
                        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" fill="#000000">
                          <path d="M56,6 L8,6 C5.794,6 4,7.794 4,10 L4,44 C4,46.206 5.794,48 8,48 L15,48 C15.551,48 16,48.449 16,49 L16,57 C16,57.396 16.233,57.754 16.595,57.915 C16.726,57.972 16.863,58 17,58 C17.244,58 17.485,57.911 17.673,57.74 L27.815,48.521 C28.184,48.185 28.662,48 29.16,48 L56,48 C58.206,48 60,46.206 60,44 L60,10 C60,7.794 58.206,6 56,6 Z M58,44 C58,45.103 57.103,46 56,46 L29.16,46 C28.163,46 27.207,46.37 26.469,47.041 L18,54.739 L18,49 C18,47.346 16.654,46 15,46 L8,46 C6.897,46 6,45.103 6,44 L6,10 C6,8.897 6.897,8 8,8 L56,8 C57.103,8 58,8.897 58,10 L58,44 Z"></path>
                        </svg>
                      </div>
                      <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                        <p class="text-xs mt-1 mb-0 font-weight-bold">Consumed</p>
                      </div>
                    </div>
                    <h4 class="font-weight-bolder" id="total-words">43</h4>
                    <div class="progress w-75">
                      <div class="progress-bar bg-dark w-50" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>

                </div><!-- /.row -->
              </div><!-- /.container -->
            </div>
          </div>
        </div>

        <div class="col-lg-7">
          <div class="card z-index-2">
            <div class="card-header pb-0">
              <h6>Minutes Consumed</h6>
              <div class="btn-group" role="group" aria-label="Basic example">
                <button type="button" class="btn btn-outline-primary" onclick="updateChartData('week'); updateStatsData('week')">Last Week</button>
                <button type="button" class="btn btn-outline-primary" onclick="updateChartData('month'); updateStatsData('month')">Last Month</button>
                <button type="button" class="btn btn-outline-primary" onclick="updateChartData('all_time'); updateStatsData('all_time')">All Time</button>
              </div>
            </div>
            <div class="card-body p-3">
              <div class="chart">
                <canvas id="cumulativeMinutesChart" class="chart-canvas" height="243"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div><!-- /.row -->

      <div id="highlight-data" style="display: none;">{{ highlight_data_json|safe }}</div>
      <div id="totals-data" style="display: none;">{{ totals_json|safe }}</div>

      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

      <!-- MOBILE FIX: px-0 -> px-3 (so Bootstrap row negative margins don't overflow) -->
      <div class="container-fluid py-4 px-3 px-md-0">
        <div class="row">
          <div class="col-12">
            <div class="card mb-4">
              <div class="card-header pb-0">
                <h6>My Log</h6>
              </div>
              <div class="card-body px-0 pt-0 pb-2">
                <div class="table-responsive p-0">
                  <table class="table align-items-center mb-0">
                    <thead>
                      <tr>
                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Title</th>
                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2 text-center"># Highlights</th>
                        <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Length</th>
                        <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Status</th>
                        <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Progress</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for media in media_info %}
                      <tr>
                        <td>
                          <div class="d-flex px-2 py-1">
                            <div>
                              <img src="{{ media.profile_image_url|default:default_image_url }}" class="avatar avatar-sm me-3" alt="media logo">
                            </div>
                            <div class="d-flex flex-column justify-content-center">
                              <h6 class="mb-0 text-sm">
                                <a href="{% url 'video_detail' media.media_id %}">
                                  {{ media.title|slice:":45" }}{% if media.title|length > 25 %}...{% endif %}
                                </a>
                              </h6>
                            </div>
                          </div>
                        </td>
                        <td class="align-middle text-center">
                          <a href="{% url 'highlights_detail' media.media_id %}" class="text-xs font-weight-bold mb-0">{{ media.total_highlights }}</a>
                        </td>
                        <td class="align-middle text-center">
                          <p class="text-xs font-weight-bold mb-0">{{ media.length }}</p>
                        </td>
                        <td class="align-middle text-center">
                          {% if media.status == 'in_progress' %}
                            <span class="badge badge-sm bg-gradient-warning">In Progress</span>
                          {% elif media.status == 'completed' %}
                            <span class="badge badge-sm bg-gradient-success">Completed</span>
                          {% else %}
                            <span class="badge badge-sm bg-gradient-secondary">{{ media.status|capfirst }}</span>
                          {% endif %}
                        </td>
                        <td class="align-middle">
                          <div class="progress-wrapper w-75 mx-auto">
                            <div class="progress-info">
                              <div class="progress-percentage">
                                <span class="text-xs font-weight-bold">{{ media.progress_percent }}%</span>
                              </div>
                            </div>
                            <div class="progress">
                              <div class="progress-bar bg-gradient-info" style="width: {{ media.progress_percent }}%" role="progressbar" aria-valuenow="{{ media.progress_percent }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                          </div>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /.container-fluid -->
  </main>

  <!-- Core JS Files -->
  <script src="{% static 'accounts/js/core/popper.min.js' %}"></script>
  <script src="{% static 'accounts/js/core/bootstrap.min.js' %}"></script>
  <script src="{% static 'accounts/js/plugins/perfect-scrollbar.min.js' %}"></script>
  <script src="{% static 'accounts/js/plugins/smooth-scrollbar.min.js' %}"></script>
  <script src="{% static 'accounts/js/plugins/chartjs.min.js' %}"></script>

  <script async defer src="https://buttons.github.io/buttons.js"></script>

  <script src="{% static 'accounts/js/soft-ui-dashboard.min.js?v=1.0.7' %}"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const sidenav = document.getElementById('sidenav-main');
      const iconSidenav = document.getElementById('iconSidenav');
      if (!sidenav || !iconSidenav) return;
      iconSidenav.addEventListener('click', function (e) {
        e.preventDefault();
        sidenav.classList.toggle('d-none');
      });
    });

    let cumulativeMinutesChart;
    let barChart;

    function createLineChart(data) {
      const canvasLine = document.getElementById('cumulativeMinutesChart');
      if (!canvasLine) return;

      const ctxLine = canvasLine.getContext('2d');
      if (cumulativeMinutesChart) cumulativeMinutesChart.destroy();

      const maxMinutes = Math.max(...data.minutes);
      const suggestedMax = maxMinutes < 5 ? 5 : Math.ceil(maxMinutes * 1.5);

      cumulativeMinutesChart = new Chart(ctxLine, {
        type: 'line',
        data: {
          labels: data.dates.map(date => new Date(date).toLocaleDateString('en-us', { month: 'short', day: 'numeric' })),
          datasets: [{
            label: 'Cumulative Minutes Watched',
            data: data.minutes,
            borderColor: 'rgb(75, 192, 192)',
            backgroundColor: 'rgba(75, 192, 192, 0.5)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              suggestedMax: suggestedMax,
              ticks: { stepSize: 1, color: '#9a9a9a' },
              grid: { color: '#e7e7e7', borderDash: [5, 5] }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#9a9a9a' }
            }
          },
          plugins: {
            legend: { display: false, position: 'top' },
            tooltip: { mode: 'index', intersect: false }
          },
          interaction: { mode: 'nearest', axis: 'x', intersect: false }
        }
      });
    }

    function createBarChart(data) {
      const canvas = document.getElementById('highlightBarChart');
      if (!canvas) return;

      const ctxBar = canvas.getContext('2d');
      if (barChart) barChart.destroy();

      barChart = new Chart(ctxBar, {
        type: 'bar',
        data: {
          labels: data.dates.map(date => new Date(date).toLocaleDateString('en-us', { month: 'short', day: 'numeric' })),
          datasets: [{
            label: 'Highlights Count',
            tension: 0.4,
            borderWidth: 0,
            borderRadius: 4,
            borderSkipped: false,
            backgroundColor: '#fff',
            data: data.highlights,
            maxBarThickness: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            title: {
              display: true,
              text: 'Highlights',
              font: { size: 18, family: 'Open Sans', weight: 'bold' },
              padding: { top: 10, bottom: 10 },
              color: '#fff'
            }
          },
          interaction: { intersect: false, mode: 'index' },
          scales: {
            y: {
              grid: { drawBorder: false, display: false, drawOnChartArea: false, drawTicks: false },
              ticks: {
                suggestedMin: 0,
                suggestedMax: Math.max(...data.highlights) * 1.2,
                beginAtZero: true,
                padding: 15,
                font: { size: 14, family: "Open Sans", style: 'normal', lineHeight: 2 },
                color: "#fff"
              }
            },
            x: {
              grid: { drawBorder: true, display: true, drawOnChartArea: true, drawTicks: true },
              ticks: { display: true }
            }
          }
        }
      });
    }

    function updateChartData(timeSpan) {
      const el = document.getElementById('highlight-data');
      if (!el) return;

      const data = JSON.parse(el.textContent);
      if (!data[timeSpan]) return;

      createLineChart({ dates: data[timeSpan].dates, minutes: data[timeSpan].minutes });
      createBarChart({ dates: data[timeSpan].dates, highlights: data[timeSpan].highlights });
      updateStatsData(timeSpan);
    }

    function updateStatsData(timeSpan) {
      const el = document.getElementById('totals-data');
      if (!el) return;

      const statsData = JSON.parse(el.textContent);
      if (!statsData[timeSpan]) return;

      const th = document.getElementById('total-highlights');
      const tm = document.getElementById('total-minutes');
      const st = document.getElementById('streak');
      const tv = document.getElementById('total-videos');
      const tw = document.getElementById('total-words');

      if (th) th.innerText = statsData[timeSpan].total_highlights || '0';
      if (tm) tm.innerText = statsData[timeSpan].total_minutes || '0';
      if (st) st.innerText = statsData[timeSpan].streak || '0';
      if (tv) tv.innerText = statsData[timeSpan].total_videos || '0';
      if (tw) tw.innerText = statsData[timeSpan].total_words || '0';
    }

    document.addEventListener('DOMContentLoaded', function () {
      updateChartData('week');

      const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    });

    document.addEventListener('DOMContentLoaded', function () {
      const banner = document.getElementById('welcome-banner');
      const body = document.body;

      function adjustPadding() {
        if (banner && banner.classList.contains('show')) {
          body.style.paddingTop = banner.offsetHeight + 'px';
        } else {
          body.style.paddingTop = '0';
        }
      }

      adjustPadding();

      if (banner) {
        const observer = new MutationObserver(function (mutations) {
          mutations.forEach(function (mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
              adjustPadding();
            }
          });
        });

        observer.observe(banner, { attributes: true, attributeFilter: ['class'] });

        banner.addEventListener('closed.bs.alert', function () {
          adjustPadding();
        });
      }
    });
  </script>

</body>
</html>
