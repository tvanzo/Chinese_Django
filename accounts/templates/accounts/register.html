{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" type="image/png" href="{% static 'accounts/img/favicon.png' %}">
  <title>Chinese Log</title>
  <!-- Fonts and icons -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <link href="{% static 'accounts/css/nucleo-icons.css' %}" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link href="{% static 'accounts/css/nucleo-svg.css' %}" rel="stylesheet" />
  <!-- CSS Files -->
  <link href="{% static 'accounts/css/soft-ui-dashboard.css' %}" rel="stylesheet" />
  <style>
    .main-content {
      background-color: #f8f9fa;
      padding-left: 0; /* Remove left padding to prevent overlap */
    }
    .card {
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border: none;
      max-width: 400px; /* Limit the width of the card */
      margin: 0 auto; /* Center the card */
    }
    .membership-selection {
      display: flex;
      justify-content: space-between;
      gap: 10px; /* Reduced gap for better alignment */
      margin-bottom: 20px;
      flex-wrap: wrap; /* Allow wrapping on smaller screens */
    }
    .membership-option {
      flex: 1 1 100%; /* Full width on mobile */
      text-align: center;
      padding: 15px; /* Reduced padding for better fit */
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      background-color: #ffffff;
    }
    .membership-option:hover {
      border-color: #7784ee;
      transform: translateY(-5px);
    }
    .membership-option.selected {
      border-color: #7784ee;
      background-color: #f0f4ff;
    }
    .membership-option h6 {
      font-size: 16px; /* Slightly smaller font size */
      font-weight: 600;
      margin-bottom: 10px;
    }
    .membership-option p {
      font-size: 12px; /* Smaller font size for better fit */
      color: #666;
    }
    .spacer {
      margin-top: 50px; /* Add space for the form */
    }
    .sidenav-header {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100px;
    }
    .custom-logo-size {
      max-height: 80%;
      width: auto;
    }
    .btn-primary {
      background-color: #7784ee;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      transition: background-color 0.3s ease;
    }
    .btn-primary:hover {
      background-color: #5a6ad1;
    }
    /* Fixed logo for mobile */
    .fixed-logo {
      display: none; /* Hidden by default */
    }
    /* Mobile-specific styles */
    @media (max-width: 768px) {
      .sidenav {
        display: none !important; /* Hide sidebar on mobile */
      }
      .navbar-vertical.navbar-expand-xs {
        display: none !important; /* Ensure the sidebar is fully hidden */
      }
      .main-content {
        padding-left: 0; /* Remove left padding */
      }
      .card {
        margin-top: 20px; /* Add space at the top */
      }
      .membership-option {
        flex: 1 1 100%; /* Full width for each plan card on mobile */
        margin-bottom: 10px; /* Add space between cards */
      }
      .fixed-logo {
        display: block; /* Show fixed logo on mobile */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background-color: #ffffff;
        z-index: 1000;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 10px 0;
        text-align: center;
      }
      .fixed-logo img {
        height: 40px; /* Adjust logo size */
        width: auto;
      }
      .spacer {
        margin-top: 80px; /* Add extra space for the fixed logo */
      }
    }
  </style>
</head>

<body class="">
  <!-- Fixed logo for mobile -->
  <div class="fixed-logo">
    <img src="{% static 'subplayer/logo.png' %}" alt="Chinese Log Logo" class="custom-logo-size" />
  </div>

  <!-- Include the original sidebar -->
  {% include 'accounts/sidebar.html' %}

  <main class="main-content mt-0">
    <section class="min-vh-100 mb-8">
      <div class="container">
        <div class="row">
          <div class="col-xl-4 col-lg-5 col-md-6 d-flex flex-column mx-auto spacer">
            <div class="card z-index-0">
              <div class="card-header text-center pt-4">
                <h5>Sign Up</h5>
              </div>
              <div class="card-body">
                <form role="form text-left" method="post" action="{% url 'register' %}">
                  {% csrf_token %}
                  {{ form.non_field_errors }}

                  <!-- Membership Selection -->
                  <div class="membership-selection">
                    <div class="membership-option" onclick="selectPlan('free')">
                      <h6>Free</h6>
                      <p>Latest 3 videos from one channel</p>
                    </div>
                    <div class="membership-option" onclick="selectPlan('basic')">
                      <h6>Basic - $10/month</h6>
                      <p>Full access to Dashu Mandarin</p>
                    </div>
                    <div class="membership-option" onclick="selectPlan('premium')">
                      <h6>Premium - $20/month</h6>
                      <p>Unlimited access to all videos</p>
                    </div>
                  </div>
                  <input type="hidden" id="selected_plan" name="selected_plan" value="">

                  <div class="mb-3">
                    <input type="text" class="form-control" placeholder="Username" name="username" aria-label="Username" aria-describedby="username-addon" required>
                    {{ form.username.errors }}
                  </div>
                  <div class="mb-3">
                    <input type="email" class="form-control" placeholder="Email" name="email" aria-label="Email" aria-describedby="email-addon" required>
                    {{ form.email.errors }}
                  </div>
                  <div class="mb-3">
                    <input type="password" class="form-control" placeholder="Password" name="password1" id="password1" aria-label="Password" aria-describedby="password1-addon" required>
                    <small class="form-text text-muted">Your password must contain at least 8 characters.</small>
                    {{ form.password1.errors }}
                  </div>
                  <div class="mb-3">
                    <input type="password" class="form-control" placeholder="Confirm Password" name="password2" id="password2" aria-label="Password confirmation" aria-describedby="password2-addon" required>
                    {{ form.password2.errors }}
                  </div>
                  <div class="mb-3">
                    <input type="text" class="form-control" placeholder="Invite Code" name="invite_code" aria-label="Invite Code" aria-describedby="invite-code-addon" required>
                    {{ form.invite_code.errors }}
                  </div>
                  <div class="text-center">
                    <button type="submit" class="btn btn-primary w-100 my-4 mb-2">Sign up</button>
                  </div>
                  <p class="text-sm mt-3 mb-0">Already have an account? <a href="{% url 'login' %}" class="text-dark font-weight-bolder">Sign in</a></p>
                </form>
                <script>
                  function selectPlan(plan) {
                    document.getElementById('selected_plan').value = plan;
                    var options = document.querySelectorAll('.membership-option');
                    options.forEach(function(option) {
                      option.classList.remove('selected');
                    });
                    document.querySelector('.membership-option[onclick="selectPlan(\'' + plan + '\')"]').classList.add('selected');
                  }

                  // Function to get URL parameter by name
                  function getParameterByName(name, url = window.location.href) {
                    name = name.replace(/[\[\]]/g, '\\$&');
                    let regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                        results = regex.exec(url);
                    if (!results) return null;
                    if (!results[2]) return '';
                    return decodeURIComponent(results[2].replace(/\+/g, ' '));
                  }

                  // On page load, check for the 'plan' parameter and pre-select the corresponding plan
                  document.addEventListener('DOMContentLoaded', function() {
                    const plan = getParameterByName('plan');
                    if (plan) {
                      selectPlan(plan);
                    } else {
                      // Default to 'free' if no plan is specified
                      selectPlan('free');
                    }
                  });
                </script>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Core JS Files -->
  <script src="{% static 'accounts/js/core/popper.min.js' %}"></script>
  <script src="{% static 'accounts/js/core/bootstrap.min.js' %}"></script>
  <script src="{% static 'accounts/js/plugins/perfect-scrollbar